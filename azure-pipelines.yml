# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml
#
#trigger:
#- main
#
#pool:
#  vmImage: ubuntu-latest
#
#steps:
#- script: echo Hello, world!
#  displayName: 'Run a one-line script'
#
#- script: |
#    echo Add other tasks to build, test, and deploy your project.
#    echo See https://aka.ms/yaml
#  displayName: 'Run a multi-line script'

#=============================================================================================

trigger:
- master

pool:
  vmImage: 'Ubuntu-16.04'

steps:
- task: Docker@2
  displayName: 'Build and Push Docker Images'
  inputs:
    command: 'buildAndPush'
    containerRegistry: 'VivaWalletProjects'
    repository: 'vivawalletproject' 
    tags: |
      user-service:$(Build.BuildId)
      order-service:$(Build.BuildId)
      payment-service:$(Build.BuildId)
- task: KubernetesManifest@0
  displayName: 'Deploy to Kubernetes'
  inputs:
    command: 'apply'
    manifests: |
      k8s/user-service.yaml
      k8s/order-service.yaml
      k8s/payment-service.yaml
